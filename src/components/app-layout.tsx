
'use client';

import Link from 'next/link';
import { BarChart3, LogOut, Users, User as UserIcon, Cog } from 'lucide-react';
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuSeparator,
    DropdownMenuTrigger,
  } from '@/components/ui/dropdown-menu';
import { useAuth } from '@/context/auth-context';
import { Button } from '@/components/ui/button';
import { Separator } from '@/components/ui/separator';
import { Avatar, AvatarFallback, AvatarImage } from './ui/avatar';
import { ThemeSwitcher } from './theme-switcher';

export function AppLayout({ children }: { children: React.ReactNode }) {
  const { logout, user } = useAuth();

  return (
    <>
      <header className="py-4 px-4 sm:px-6 lg:px-8 flex items-center justify-between gap-4">
        <div className="flex items-center gap-4">
          <Link href="/" className="flex items-center gap-4">
            <svg
                className="w-20 h-auto"
                viewBox="0 0 405 251"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                >
                <path
                    d="M381.652 0.942383C343.352 -3.45762 256.452 14.5424 201.252 72.1424C146.052 129.742 101.952 135.242 63.8522 133.342C25.7522 131.442 -14.6478 102.142 5.15219 56.5424C24.9522 10.9424 104.952 -13.1576 154.252 20.2424"
                    stroke="#FBE122"
                    strokeWidth="15"
                />
                <path
                    d="M381.652 250.057C343.352 254.457 256.452 236.457 201.252 178.857C146.052 121.257 101.952 115.757 63.8522 117.657C25.7522 119.557 -14.6478 148.857 5.15219 194.457C24.9522 239.957 104.952 264.157 154.252 230.757"
                    stroke="#FBE122"
                    strokeWidth="15"
                />
                <path
                    d="M381.652 0.942383C343.352 -3.45762 256.452 14.5424 201.252 72.1424C146.052 129.742 101.952 135.242 63.8522 133.342C25.7522 131.442 -14.6478 102.142 5.15219 56.5424C24.9522 10.9424 104.952 -13.1576 154.252 20.2424"
                    fill="#ED3237"
                />
                <path
                    d="M381.652 250.057C343.352 254.457 256.452 236.457 201.252 178.857C146.052 121.257 101.952 115.757 63.8522 117.657C25.7522 119.557 -14.6478 148.857 5.15219 194.457C24.9522 239.957 104.952 264.157 154.252 230.757"
                    fill="#ED3237"
                />
                <path
                    d="M201.252 72.1424C256.452 14.5424 343.352 -3.45762 381.652 0.942383L396.952 125.557L381.652 250.057C343.352 254.457 256.452 236.457 201.252 178.857"
                    fill="#ED3237"
                />
                <path
                    d="M5.15219 56.5424C-14.6478 102.142 25.7522 131.442 63.8522 133.342C101.952 135.242 146.052 129.742 201.252 72.1424"
                    fill="#ED3237"
                />
                <path
                    d="M5.15219 194.457C-14.6478 148.857 25.7522 119.557 63.8522 117.657C101.952 115.757 146.052 121.257 201.252 178.857"
                    fill="#ED3237"
                />
                <path
                    d="M239.141 113.818C239.141 110.318 239.441 107.218 240.041 104.518C240.641 101.718 241.441 99.4183 242.441 97.6183C243.541 95.8183 244.741 94.4183 246.041 93.4183C247.441 92.4183 248.841 91.8183 250.241 91.6183C251.641 91.3183 253.041 91.2183 254.441 91.3183C256.641 91.3183 258.541 91.8183 260.141 92.8183C261.741 93.8183 262.941 95.2183 263.741 97.0183C264.541 98.8183 264.941 100.918 264.941 103.318C264.941 105.118 264.641 106.918 264.041 108.718C263.441 110.518 262.541 112.118 261.341 113.518C260.141 114.918 258.741 116.018 257.141 116.818C255.541 117.618 253.841 118.018 252.041 118.018C250.041 118.018 248.241 117.518 246.641 116.518C245.041 115.518 243.741 114.418 242.741 113.018L243.641 119.518L239.141 120.218V113.818ZM252.341 112.518C254.441 112.518 256.141 111.718 257.441 110.118C258.741 108.518 259.341 106.318 259.341 103.518C259.341 100.818 258.741 98.7183 257.541 97.2183C256.341 95.7183 254.741 94.9183 252.741 94.9183C250.741 94.9183 249.141 95.7183 247.941 97.3183C246.741 98.9183 246.141 100.918 246.141 103.318C246.141 106.018 246.741 108.118 247.941 109.618C249.141 111.118 250.641 112.518 252.341 112.518Z"
                    fill="#FBE122"
                />
                <path
                    d="M268.083 120.218V91.5183H272.583V120.218H268.083Z"
                    fill="#FBE122"
                />
                <path
                    d="M294.925 120.218V91.5183H303.825C306.525 91.5183 308.625 92.1183 310.125 93.3183C311.625 94.5183 312.325 96.1183 312.325 98.1183C312.325 99.4183 312.025 100.518 311.425 101.418C310.825 102.318 310.025 103.018 309.025 103.518C309.825 103.918 310.525 104.518 311.125 105.318C311.725 106.118 312.125 107.018 312.325 108.018L314.925 120.218H310.025L307.725 109.418C307.525 108.518 307.225 107.818 306.825 107.318C306.425 106.818 305.825 106.318 305.025 105.818H300.425V120.218H294.925ZM300.425 102.618H304.325C305.825 102.618 306.925 102.218 307.625 101.418C308.325 100.618 308.625 99.6183 308.625 98.4183C308.625 97.2183 308.225 96.3183 307.425 95.7183C306.625 95.1183 305.525 94.8183 304.125 94.8183H300.425V102.618Z"
                    fill="#FBE122"
                />
                <path
                    d="M320.167 120.218V91.5183H324.667V120.218H320.167Z"
                    fill="#FBE122"
                />
                <path
                    d="M331.009 120.218V91.5183H335.509V108.318L347.909 91.5183H353.609L342.509 106.118L354.109 120.218H348.109L339.709 108.618L337.809 110.718V120.218H331.009Z"
                    fill="#FBE122"
                />
                <path
                    d="M228.315 76.8183C226.715 75.6183 224.915 74.8183 222.915 74.4183C220.915 73.9183 218.915 73.6183 216.915 73.5183C213.615 73.5183 210.815 74.1183 208.515 75.3183C206.215 76.5183 204.615 78.2183 203.715 80.4183C202.815 82.6183 202.415 85.1183 202.515 87.9183C202.515 89.8183 202.815 91.6183 203.415 93.3183C204.015 95.0183 204.815 96.5183 205.815 97.8183C206.815 99.1183 207.915 100.118 209.115 100.818C210.415 101.518 211.715 101.818 213.015 101.718C215.315 101.718 217.315 101.118 219.015 99.9183C220.715 98.7183 222.015 97.1183 222.915 95.1183L227.415 96.1183C226.915 97.7183 226.115 99.2183 225.015 100.618C223.915 102.018 222.515 103.218 220.815 104.218C219.115 105.218 217.215 105.818 215.115 106.018C213.015 106.218 210.915 106.118 208.815 105.618C204.615 104.618 201.215 102.418 198.615 99.0183C196.015 95.6183 194.715 91.5183 194.715 86.7183C194.715 83.2183 195.415 80.1183 196.815 77.4183C198.215 74.7183 200.215 72.5183 202.815 70.8183C205.415 69.1183 208.515 68.2183 212.115 68.1183C215.315 68.1183 218.115 68.6183 220.515 69.6183C222.915 70.6183 224.915 72.0183 226.515 73.8183L223.315 77.0183C224.615 76.2183 226.115 75.4183 227.815 74.6183"
                    fill="white"
                />
                <path
                    d="M205.152 45.9184C207.252 47.7184 208.952 49.6184 210.252 51.6184C211.552 53.6184 212.452 55.6184 212.952 57.6184C213.452 59.6184 213.652 61.5184 213.552 63.3184C213.552 65.5184 213.052 67.5184 212.052 69.3184C211.052 71.1184 209.652 72.6184 207.852 73.8184C206.052 75.0184 204.052 75.8184 201.852 76.2184C199.652 76.6184 197.352 76.6184 194.952 76.2184C192.552 75.8184 190.352 75.0184 188.352 73.8184C186.352 72.6184 184.752 71.0184 183.552 69.0184C182.352 67.0184 181.552 64.7184 181.152 62.1184C179.952 64.2184 178.552 66.0184 176.952 67.5184C175.352 69.0184 173.552 70.1184 171.552 70.8184C169.552 71.5184 167.452 71.8184 165.252 71.7184C161.852 71.7184 159.052 71.0184 156.852 69.6184C154.652 68.2184 153.052 66.2184 152.052 63.6184C151.052 61.0184 150.552 58.0184 150.552 54.6184C150.552 51.5184 151.052 48.7184 152.052 46.2184C153.052 43.7184 154.552 41.7184 156.552 40.2184C158.552 38.7184 160.952 37.9184 163.752 37.8184C165.752 37.8184 167.652 38.1184 169.452 38.7184C171.252 39.3184 172.852 40.2184 174.252 41.4184C175.652 42.6184 176.752 43.9184 177.552 45.3184C178.352 46.7184 178.952 48.1184 179.352 49.5184C180.152 47.5184 181.252 45.7184 182.652 44.1184C184.052 42.5184 185.652 41.2184 187.452 40.2184C189.252 39.2184 191.252 38.7184 193.452 38.7184C196.352 38.7184 198.752 39.4184 200.652 40.8184C202.552 42.2184 204.052 43.9184 205.152 45.9184Z"
                    fill="white"
                />
                <path
                    d="M178.294 150.318H171.794L168.194 163.718L164.694 150.318H158.194L165.694 172.518H170.694L178.294 150.318Z"
                    fill="white"
                />
                <path
                    d="M199.136 150.318H184.336V172.518H199.136V168.618H188.936V163.118H198.236V159.218H188.936V154.218H199.136V150.318Z"
                    fill="white"
                />
                <path
                    d="M218.478 150.318H211.978L202.878 172.518H208.178L210.378 167.318H220.078L222.278 172.518H227.578L218.478 150.318ZM215.278 154.218L218.378 163.118H212.178L215.278 154.218Z"
                    fill="white"
                />
                <path
                    d="M228.32 172.518V150.318H244.72V154.218H232.92V159.418H243.32V163.318H232.92V168.618H245.22V172.518H228.32Z"
                    fill="white"
                />
                <path
                    d="M264.462 150.318H250.662V172.518H255.262V163.118H264.462V172.518H269.062V150.318H264.462ZM264.462 159.218H255.262V154.218H264.462V159.218Z"
                    fill="white"
                />
            </svg>
            <div>
                <h1 className="text-3xl font-bold tracking-tight text-primary font-headline">
                Gerenciador Pema
                </h1>
                <p className="text-muted-foreground">Sistema de Ponto de Venda</p>
            </div>
          </Link>
        </div>
        <div className="flex items-center gap-4">
          {user?.role === 'admin' && (
            <>
              <Button asChild>
                  <Link href="/users">
                      <Users className="mr-2"/>
                      Gerenciar Usuários
                  </Link>
              </Button>
              <ThemeSwitcher />
            </>
          )}
          {user?.role !== 'vendedor' && (
            <Button asChild>
                <Link href="/reports">
                <BarChart3 className="mr-2" />
                Ver Relatórios
                </Link>
            </Button>
          )}

          <DropdownMenu>
            <DropdownMenuTrigger asChild>
                <Button variant="ghost" className="relative h-10 w-10 rounded-full">
                    <Avatar className="h-10 w-10">
                        <AvatarImage src={user?.avatarUrl} alt={user?.username} />
                        <AvatarFallback>
                            <UserIcon />
                        </AvatarFallback>
                    </Avatar>
                </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent className="w-56" align="end" forceMount>
              <DropdownMenuLabel className="font-normal">
                <div className="flex flex-col space-y-1">
                  <p className="text-sm font-medium leading-none">{user?.username}</p>
                  <p className="text-xs leading-none text-muted-foreground">
                    {user?.role}
                  </p>
                </div>
              </DropdownMenuLabel>
              <DropdownMenuSeparator />
              <DropdownMenuItem asChild>
                <Link href="/profile">
                    <Cog className="mr-2" />
                    Editar Perfil
                </Link>
              </DropdownMenuItem>
              <DropdownMenuItem onClick={logout}>
                <LogOut className="mr-2" />
                Sair
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        </div>
      </header>
      <Separator className="mb-4" />
      <div className="px-4 sm:px-6 lg:px-8 pt-0">{children}</div>
    </>
  );
}

    